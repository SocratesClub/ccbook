---
redirect_from:
  - "06-data-cleaning-tweets"
interact_link: content/06_data_cleaning_Tweets.ipynb
kernel_name: python3
has_widgets: false
title: |-
  Chapter 4. Data Cleaning
prev_page:
  url: /04_PythonCrawlerGovernmentReport.html
  title: |-
    Crawling Government Reports
next_page:
  url: /07_data_cleaning_occupy_central_news.html
  title: |-
    Cleaning the News of Occupy Central
comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---
<main class="jupyter-page">

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>
<hr>
<h1 id="&#25968;&#25454;&#28165;&#27927;&#20043;&#25512;&#29305;&#25968;&#25454;">&#25968;&#25454;&#28165;&#27927;&#20043;&#25512;&#29305;&#25968;&#25454;<a class="anchor-link" href="#&#25968;&#25454;&#28165;&#27927;&#20043;&#25512;&#29305;&#25968;&#25454;"> </a></h1><hr>
<hr>
<p>ç‹æˆå†›</p>
<p>wangchengjun@nju.edu.cn</p>
<p>è®¡ç®—ä¼ æ’­ç½‘ <a href="http://computational-communication.com">http://computational-communication.com</a></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#25968;&#25454;&#28165;&#27927;&#65288;data-cleaning&#65289;">&#25968;&#25454;&#28165;&#27927;&#65288;data cleaning&#65289;<a class="anchor-link" href="#&#25968;&#25454;&#28165;&#27927;&#65288;data-cleaning&#65289;"> </a></h2><p>æ˜¯æ•°æ®åˆ†æçš„é‡è¦æ­¥éª¤ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯å°†æ··æ‚çš„æ•°æ®æ¸…æ´—ä¸ºå¯ä»¥è¢«ç›´æ¥åˆ†æçš„æ•°æ®ï¼Œä¸€èˆ¬éœ€è¦å°†æ•°æ®è½¬åŒ–ä¸ºæ•°æ®æ¡†ï¼ˆdata frameï¼‰çš„æ ·å¼ã€‚</p>
<p>æœ¬ç« å°†ä»¥æ¨ç‰¹æ–‡æœ¬çš„æ¸…æ´—ä½œä¸ºä¾‹å­ï¼Œä»‹ç»æ•°æ®æ¸…æ´—çš„åŸºæœ¬é€»è¾‘ã€‚</p>
<ul>
<li>æ¸…æ´—é”™è¯¯è¡Œ</li>
<li>æ­£ç¡®åˆ†åˆ—</li>
<li>æå–æ‰€è¦åˆ†æçš„å†…å®¹</li>
<li>ä»‹ç»é€šè¿‡æŒ‰è¡Œã€chunkçš„æ–¹å¼å¯¹å¤§è§„æ¨¡æ•°æ®è¿›è¡Œé¢„å¤„ç†</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="1.-&#25277;&#21462;tweets&#26679;&#26412;&#20570;&#23454;&#39564;">1. &#25277;&#21462;tweets&#26679;&#26412;&#20570;&#23454;&#39564;<a class="anchor-link" href="#1.-&#25277;&#21462;tweets&#26679;&#26412;&#20570;&#23454;&#39564;"> </a></h1><p>æ­¤èŠ‚å­¦ç”Ÿç•¥è¿‡</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bigfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/Users/chengjun/ç™¾åº¦äº‘åŒæ­¥ç›˜/Writing/OWS/ows-raw.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">chunkSize</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">bigfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="n">chunkSize</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/Users/chengjun/GitHub/cjc/data/ows_tweets_sample.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2752
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Lazy-Method-for-Reading-Big-File-in-Python?">Lazy Method for Reading Big File in Python?<a class="anchor-link" href="#Lazy-Method-for-Reading-Big-File-in-Python?"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/questions/519633/lazy-method-for-reading-big-file-in-python?lq=1</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="n">bigfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/Users/datalab/bigdata/cjc/ows-raw.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">chunkSize</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">8</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">bigfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="n">chunkSize</span><span class="p">)</span>
<span class="n">num</span><span class="p">,</span> <span class="n">num_lines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">),</span> 
                       <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="c1">#do sth.</span>
    <span class="n">num_lines</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">num_lines</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">bigfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="n">chunkSize</span><span class="p">)</span> <span class="c1"># read another chunk</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 262665
1 525130
2 787344
3 1049351
4 1312571
5 1574666
6 1835628
7 2097136
8 2358494
9 2619723
10 2880857
11 3140945
12 3404775
13 3665565
14 3927996
15 4189419
16 4449078
17 4709001
18 4969877
19 5230937
20 5492578
21 5756613
22 6022478
23 6286119
24 6549476
25 6602141
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#23383;&#33410;&#65288;Byte-/bait/&#65289;">&#23383;&#33410;&#65288;Byte /bait/&#65289;<a class="anchor-link" href="#&#23383;&#33410;&#65288;Byte-/bait/&#65289;"> </a></h1><p>è®¡ç®—æœºä¿¡æ¯æŠ€æœ¯ç”¨äºè®¡é‡å­˜å‚¨å®¹é‡çš„ä¸€ç§è®¡é‡å•ä½ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸€å­—èŠ‚ç­‰äºæœ‰å…«ä½ï¼Œ [1]  ä¹Ÿè¡¨ç¤ºä¸€äº›è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ä¸­çš„æ•°æ®ç±»å‹å’Œè¯­è¨€å­—ç¬¦ã€‚</p>
<ul>
<li>1Bï¼ˆbyteï¼Œå­—èŠ‚ï¼‰= 8 bitï¼›</li>
<li>1KB=1000Bï¼›1MB=1000KB=1000Ã—1000Bã€‚å…¶ä¸­1000=10^3ã€‚</li>
<li>1KBï¼ˆkilobyteï¼Œåƒå­—èŠ‚ï¼‰=1000B= 10^3 Bï¼›</li>
<li>1MBï¼ˆMegabyteï¼Œå…†å­—èŠ‚ï¼Œç™¾ä¸‡å­—èŠ‚ï¼Œç®€ç§°â€œå…†â€ï¼‰=1000KB= 10^6 Bï¼›</li>
<li>1GBï¼ˆGigabyteï¼Œå‰å­—èŠ‚ï¼Œåäº¿å­—èŠ‚ï¼Œåˆç§°â€œåƒå…†â€ï¼‰=1000MB= 10^9 Bï¼›</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#29992;Pandas&#30340;get_chunk&#21151;&#33021;&#26469;&#22788;&#29702;&#20159;&#32423;&#25968;&#25454;">&#29992;Pandas&#30340;get_chunk&#21151;&#33021;&#26469;&#22788;&#29702;&#20159;&#32423;&#25968;&#25454;<a class="anchor-link" href="#&#29992;Pandas&#30340;get_chunk&#21151;&#33021;&#26469;&#22788;&#29702;&#20159;&#32423;&#25968;&#25454;"> </a></h2><blockquote><p>åªæœ‰åœ¨è¶…è¿‡5TBæ•°æ®é‡çš„è§„æ¨¡ä¸‹ï¼ŒHadoopæ‰æ˜¯ä¸€ä¸ªåˆç†çš„æŠ€æœ¯é€‰æ‹©ã€‚</p>
</blockquote>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../bigdata/OWS/ows-raw.txt&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">f</span><span class="p">,</span>  <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>  <span class="n">iterator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#è·³è¿‡æŠ¥é”™è¡Œ</span>
<span class="n">loop</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">chunkSize</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="n">loop</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_chunk</span><span class="p">(</span><span class="n">chunkSize</span><span class="p">)</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">data_cleaning_funtion</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="c1"># do sth.</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> 
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration is stopped.&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="2.-&#28165;&#27927;&#38169;&#34892;&#30340;&#24773;&#20917;">2. &#28165;&#27927;&#38169;&#34892;&#30340;&#24773;&#20917;<a class="anchor-link" href="#2.-&#28165;&#27927;&#38169;&#34892;&#30340;&#24773;&#20917;"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># æ€»è¡Œæ•°</span>
<span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2753</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># æŸ¥çœ‹ç¬¬ä¸€è¡Œ</span>
<span class="n">lines</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;121813245488140288,&#34;@HumanityCritic i\&#39;m worried that the #ows sells out to the hamsher-norquist spitefuck, and tries to unite with the teahad.&#34;,http://a2.twimg.com/profile_images/627683576/flytits_normal.jpg,2011-10-06,5,5,&#34;2011-10-06 05:05:15&#34;,N;,fucentarmal,27480502,en,HumanityCritic,230431,&#34;&amp;lt;a href=&amp;quot;http://www.tweetdeck.com&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;TweetDeck&amp;lt;/a&amp;gt;&#34;\n&#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on built-in function split:

split(...) method of builtins.str instance
    S.split(sep=None, maxsplit=-1) -&gt; list of strings
    
    Return a list of the words in S, using sep as the
    delimiter string.  If maxsplit is given, at most maxsplit
    splits are done. If sep is not specified or is None, any
    whitespace string is a separator and empty strings are
    removed from the result.

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#38382;&#39064;&#65306;-&#31532;&#19968;&#34892;&#26159;&#21464;&#37327;&#21517;">&#38382;&#39064;&#65306; &#31532;&#19968;&#34892;&#26159;&#21464;&#37327;&#21517;<a class="anchor-link" href="#&#38382;&#39064;&#65306;-&#31532;&#19968;&#34892;&#26159;&#21464;&#37327;&#21517;"> </a></h1><blockquote><h2 id="1.-&#22914;&#20309;&#21435;&#25481;&#25442;&#34892;&#31526;&#65311;">1. &#22914;&#20309;&#21435;&#25481;&#25442;&#34892;&#31526;&#65311;<a class="anchor-link" href="#1.-&#22914;&#20309;&#21435;&#25481;&#25442;&#34892;&#31526;&#65311;"> </a></h2><h2 id="2.-&#22914;&#20309;&#33719;&#21462;&#27599;&#19968;&#20010;&#21464;&#37327;&#21517;&#65311;">2. &#22914;&#20309;&#33719;&#21462;&#27599;&#19968;&#20010;&#21464;&#37327;&#21517;&#65311;<a class="anchor-link" href="#2.-&#22914;&#20309;&#33719;&#21462;&#27599;&#19968;&#20010;&#21464;&#37327;&#21517;&#65311;"> </a></h2>
</blockquote>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varNames</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">varNames</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&#34;Twitter ID&#34;&#39;,
 &#39;Text&#39;,
 &#39;&#34;Profile Image URL&#34;&#39;,
 &#39;Day&#39;,
 &#39;Hour&#39;,
 &#39;Minute&#39;,
 &#39;&#34;Created At&#34;&#39;,
 &#39;Geo&#39;,
 &#39;&#34;From User&#34;&#39;,
 &#39;&#34;From User ID&#34;&#39;,
 &#39;Language&#39;,
 &#39;&#34;To User&#34;&#39;,
 &#39;&#34;To User ID&#34;&#39;,
 &#39;Source&#39;]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">varNames</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>14</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lines</span><span class="p">[</span><span class="mi">1344</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;121818600490283009,&#34;RT @chachiTHEgr8: RT @TheNewDeal: First they ignore you, then they laugh at you, then they fight you, then you win. - Gandhi #OccupyWallStreet #OWS #p2&#34;,http://a0.twimg.com/profile_images/326662126/Photo_233_normal.jpg,2011-10-06,5,26,&#34;2011-10-06 05:26:32&#34;,N;,k_l_h_j,382233343,en,,0,&#34;&amp;lt;a href=&amp;quot;http://twitter.com/#!/download/iphone&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Twitter for iPhone&amp;lt;/a&amp;gt;&#34;\n&#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#22914;&#20309;&#26469;&#22788;&#29702;&#38169;&#35823;&#25442;&#34892;&#24773;&#20917;&#65311;">&#22914;&#20309;&#26469;&#22788;&#29702;&#38169;&#35823;&#25442;&#34892;&#24773;&#20917;&#65311;<a class="anchor-link" href="#&#22914;&#20309;&#26469;&#22788;&#29702;&#38169;&#35823;&#25442;&#34892;&#24773;&#20917;&#65311;"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample_clean.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">right_line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># æ­£ç¡®çš„è¡Œï¼Œå®ƒæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># ç¡®è®¤ä¸ºæ­£ç¡®çš„è¡Œä¼šè¢«æ·»åŠ åˆ°blocksé‡Œé¢</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">right_line</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">line_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">line_length</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_line</span><span class="p">)</span>
            <span class="n">right_line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2627</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span><span class="p">[</span><span class="mi">1344</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;121818879105310720,&#34;RT @Min_Reyes: RT @The99Percenters: New video to go viral. From We Are Change http://t.co/6Ff718jk Listen to the guy begging... #ows #cdnpoli&#34;,http://a3.twimg.com/sticky/default_profile_images/default_profile_0_normal.png,2011-10-06,5,27,&#34;2011-10-06 05:27:38&#34;,N;,MiyazakiMegu,260948518,en,,0,&#34;&amp;lt;a href=&amp;quot;http://www.tweetdeck.com&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;TweetDeck&amp;lt;/a&amp;gt;&#34; &#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#21516;&#26102;&#32771;&#34385;&#20998;&#21015;&#31526;&#21644;&#24341;&#29992;&#31526;">&#21516;&#26102;&#32771;&#34385;&#20998;&#21015;&#31526;&#21644;&#24341;&#29992;&#31526;<a class="anchor-link" href="#&#21516;&#26102;&#32771;&#34385;&#20998;&#21015;&#31526;&#21644;&#24341;&#29992;&#31526;"> </a></h1><ul>
<li>åˆ†åˆ—ç¬¦ğŸ”¥åˆ†éš”ç¬¦ï¼šsep, delimiter</li>
<li>å¼•ç”¨ç¬¦â˜ï¸ï¼šquotechar</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&quot;|&quot;,&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;121813245488140288&#39;,
 &#34;@HumanityCritic i&#39;m worried that the #ows sells out to the hamsher-norquist spitefuck, and tries to unite with the teahad.&#34;,
 &#39;http://a2.twimg.com/profile_images/627683576/flytits_normal.jpg,2011-10-06,5,5&#39;,
 &#39;2011-10-06 05:05:15&#39;,
 &#39;N;,fucentarmal,27480502,en,HumanityCritic,230431&#39;,
 &#39;&amp;lt;a href=&amp;quot;http://www.tweetdeck.com&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;TweetDeck&amp;lt;/a&amp;gt;&#34;\n&#39;]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample.txt&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">i_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&quot;|&quot;,&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;line =&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39; length =&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>line = 35  length = 6
line = 36  length = 6
line = 37  length = 6
line = 38  length = 6
line = 39  length = 6
line = 40  length = 6
line = 41  length = 2
line = 42  length = 5
line = 43  length = 6
line = 44  length = 6
line = 45  length = 6
line = 46  length = 6
line = 47  length = 6
line = 48  length = 2
line = 49  length = 5
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample_clean4.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">right_line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># æ­£ç¡®çš„è¡Œï¼Œå®ƒæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># ç¡®è®¤ä¸ºæ­£ç¡®çš„è¡Œä¼šè¢«æ·»åŠ åˆ°blocksé‡Œé¢</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">right_line</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="c1">#line_length = len(right_line.split(&#39;,&#39;))</span>
        <span class="n">i_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&quot;|&quot;,&#39;</span><span class="p">,</span> <span class="n">right_line</span><span class="p">)</span>
        <span class="n">line_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line_length</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_line</span><span class="p">)</span>
            <span class="n">right_line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="c1">#     for i in blocks:</span>
<span class="c1">#         f.write(i + &#39;\n&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2626</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="3.-&#35835;&#21462;&#25968;&#25454;&#12289;&#27491;&#30830;&#20998;&#21015;">3. &#35835;&#21462;&#25968;&#25454;&#12289;&#27491;&#30830;&#20998;&#21015;<a class="anchor-link" href="#3.-&#35835;&#21462;&#25968;&#25454;&#12289;&#27491;&#30830;&#20998;&#21015;"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># æç¤ºï¼šä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä»¥ä¸‹è·¯å¾„å</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2753</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunk</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&#34;Twitter ID&#34;,Text,&#34;Profile Image URL&#34;,Day,Hour,Minute,&#34;Created At&#34;,Geo,&#34;From User&#34;,&#34;From User ID&#34;,Language,&#34;To User&#34;,&#34;To User ID&#34;,Source\n&#39;,
 &#39;121813144174727168,&#34;RT @AnonKitsu: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE RT !!HELP!!!!&#34;,http://a2.twimg.com/profile_images/1539375713/Twitter_normal.jpg,2011-10-06,5,4,&#34;2011-10-06 05:04:51&#34;,N;,Anonops_Cop,401240477,en,,0,&#34;&amp;lt;a href=&amp;quot;http://twitter.com/&amp;quot;&amp;gt;web&amp;lt;/a&amp;gt;&#34;\n&#39;,
 &#39;121813146137657344,&#34;@jamiekilstein @allisonkilkenny Interesting interview (never aired, wonder why??) by Fox with #ows protester http://t.co/Fte55Kh7&#34;,http://a2.twimg.com/profile_images/1574715503/Kate6_normal.jpg,2011-10-06,5,4,&#34;2011-10-06 05:04:51&#34;,N;,KittyHybrid,34532053,en,jamiekilstein,2149053,&#34;&amp;lt;a href=&amp;quot;http://twitter.com/&amp;quot;&amp;gt;web&amp;lt;/a&amp;gt;&#34;\n&#39;]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="n">lines_csv</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lines_csv</span><span class="p">)))</span>
<span class="c1"># next(lines_csv)</span>
<span class="c1"># next(lines_csv)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2627
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">):</span>
    <span class="n">rt_patterns</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(RT|via)((?:\b\W*@\w+)+)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_patterns</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rt_user_name</span><span class="p">:</span>
        <span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_user_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; @&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rt_user_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">rt_user_name</span>

<span class="n">rt_network</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>   
    <span class="c1">#lines = csv.reader(chunk, delimiter=&#39;,&#39;, quotechar=&#39;&quot;&#39;) </span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">tweet</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">from_user</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">rt_user</span> <span class="o">=</span> <span class="n">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
        <span class="n">rt_network</span><span class="p">[(</span><span class="n">from_user</span><span class="p">,</span> <span class="n">rt_user</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>    
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample.txt&quot;</span><span class="p">,</span>
                 <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Twitter ID</th>
      <th>Text</th>
      <th>Profile Image URL</th>
      <th>Day</th>
      <th>Hour</th>
      <th>Minute</th>
      <th>Created At</th>
      <th>Geo</th>
      <th>From User</th>
      <th>From User ID</th>
      <th>Language</th>
      <th>To User</th>
      <th>To User ID</th>
      <th>Source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>121813144174727168</td>
      <td>RT @AnonKitsu: ALERT!!!!!!!!!!COPS ARE KETTLIN...</td>
      <td>http://a2.twimg.com/profile_images/1539375713/...</td>
      <td>2011-10-06</td>
      <td>5</td>
      <td>4</td>
      <td>2011-10-06 05:04:51</td>
      <td>N;</td>
      <td>Anonops_Cop</td>
      <td>401240477</td>
      <td>en</td>
      <td>NaN</td>
      <td>0</td>
      <td>&amp;lt;a href=&amp;quot;http://twitter.com/&amp;quot;&amp;gt;...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>121813146137657344</td>
      <td>@jamiekilstein @allisonkilkenny Interesting in...</td>
      <td>http://a2.twimg.com/profile_images/1574715503/...</td>
      <td>2011-10-06</td>
      <td>5</td>
      <td>4</td>
      <td>2011-10-06 05:04:51</td>
      <td>N;</td>
      <td>KittyHybrid</td>
      <td>34532053</td>
      <td>en</td>
      <td>jamiekilstein</td>
      <td>2149053</td>
      <td>&amp;lt;a href=&amp;quot;http://twitter.com/&amp;quot;&amp;gt;...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>121813150000619521</td>
      <td>@Seductivpancake Right! Those guys have a vict...</td>
      <td>http://a1.twimg.com/profile_images/1241412831/...</td>
      <td>2011-10-06</td>
      <td>5</td>
      <td>4</td>
      <td>2011-10-06 05:04:52</td>
      <td>N;</td>
      <td>nerdsherpa</td>
      <td>95067344</td>
      <td>en</td>
      <td>Seductivpancake</td>
      <td>19695580</td>
      <td>&amp;lt;a href=&amp;quot;http://www.echofon.com/&amp;quot;...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2626</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">Text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;RT @AnonKitsu: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE RT !!HELP!!!!&#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;From User&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0       Anonops_Cop
1       KittyHybrid
2        nerdsherpa
3        hamudistan
4           kl_knox
5     vickycrampton
6    burgerbuilders
7          neverfox
8       davidgaliel
9           AnonOws
Name: From User, dtype: object</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="4.-&#32479;&#35745;&#25968;&#37327;">4. &#32479;&#35745;&#25968;&#37327;<a class="anchor-link" href="#4.-&#32479;&#35745;&#25968;&#37327;"> </a></h1><h3 id="&#32479;&#35745;&#21457;&#24086;&#25968;&#37327;&#25152;&#23545;&#24212;&#30340;&#20154;&#25968;&#30340;&#20998;&#24067;">&#32479;&#35745;&#21457;&#24086;&#25968;&#37327;&#25152;&#23545;&#24212;&#30340;&#20154;&#25968;&#30340;&#20998;&#24067;<a class="anchor-link" href="#&#32479;&#35745;&#21457;&#24086;&#25968;&#37327;&#25152;&#23545;&#24212;&#30340;&#20154;&#25968;&#30340;&#20998;&#24067;"> </a></h3><blockquote><p>äººæ•°åœ¨å‘å¸–æ•°é‡æ–¹é¢çš„åˆ†å¸ƒæƒ…å†µ</p>
</blockquote>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="n">data_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;From User&#39;</span><span class="p">]:</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span><span class="mi">1</span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
<span class="c1">#data_dict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;MiranHosny&#39;, 1),
 (&#39;BradMarston&#39;, 1),
 (&#39;Sir_Richard_311&#39;, 1),
 (&#39;elChepi&#39;, 1),
 (&#39;jboy&#39;, 1)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#23433;&#35013;&#24494;&#36719;&#38597;&#40657;&#23383;&#20307;">&#23433;&#35013;&#24494;&#36719;&#38597;&#40657;&#23383;&#20307;<a class="anchor-link" href="#&#23433;&#35013;&#24494;&#36719;&#38597;&#40657;&#23383;&#20307;"> </a></h3><p>ä¸ºäº†åœ¨ç»˜å›¾æ—¶æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡ï¼Œéœ€è¦å®‰è£…/data/æ–‡ä»¶å¤¹ä¸­çš„å¾®è½¯é›…é»‘å­—ä½“ï¼ˆmsyh.ttfï¼‰</p>
<p>è¯¦è§<a href="0.common_questions.ipynb">common questions</a></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="c1">#plt.yscale(&#39;log&#39;)</span>
<span class="c1">#plt.xscale(&#39;log&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;å‘å¸–æ•°&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;äººæ•°&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/06_data_cleaning_Tweets_42_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tweet_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">tweet_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
 
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">tweet_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">tweet_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span><span class="c1">#linewidth=2)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;æ¨ç‰¹æ•°&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;äººæ•°&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/06_data_cleaning_Tweets_43_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="k">def</span> <span class="nf">powerPlot</span><span class="p">(</span><span class="n">d_value</span><span class="p">,</span> <span class="n">d_freq</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
    <span class="n">d_freq</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_freq</span><span class="p">]</span>
    <span class="n">d_prob</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">d_freq</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_freq</span><span class="p">]</span>
    <span class="c1">#d_rank = ss.rankdata(d_value).astype(int)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_value</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_prob</span><span class="p">)</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">constant</span><span class="p">,</span><span class="n">beta</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">rsquared</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d_value</span><span class="p">,</span> <span class="n">d_prob</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>\
             <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d_value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">constant</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">beta</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d_value</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">d_prob</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span>
             <span class="sa">r</span><span class="s1">&#39;$\beta$ = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$R^2$ = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">histo</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">bin_center</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">powerPlot</span><span class="p">(</span><span class="n">bin_center</span><span class="p">,</span><span class="n">histo</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">)</span>
<span class="c1">#lg=plt.legend(labels = [u&#39;Tweets&#39;, u&#39;Fit&#39;], loc=3, fontsize=20)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;æ¦‚ç‡&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;æ¨ç‰¹æ•°&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/06_data_cleaning_Tweets_45_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">powerPlot2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
    <span class="n">d_table</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">d_table</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">d_value</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d_table</span><span class="p">)</span>
    <span class="n">d_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_value</span><span class="p">]</span>
    <span class="n">d_freq</span> <span class="o">=</span> <span class="p">[</span><span class="n">d_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_value</span><span class="p">]</span>
    <span class="n">d_prob</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">d_freq</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_freq</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_value</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_prob</span><span class="p">)</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">constant</span><span class="p">,</span><span class="n">beta</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">rsquared</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d_value</span><span class="p">,</span> <span class="n">d_prob</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d_value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">constant</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">beta</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d_value</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">d_prob</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span>
             <span class="s1">&#39;Beta = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;R squared = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P(K)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">powerPlot2</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/06_data_cleaning_Tweets_47_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">powerlaw</span>
<span class="k">def</span> <span class="nf">plotPowerlaw</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">xlab</span><span class="p">):</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">powerlaw</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">xmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#fit = powerlaw.Fit(data)</span>
    <span class="n">fit</span><span class="o">.</span><span class="n">plot_pdf</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">power_law</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="n">fit</span><span class="o">.</span><span class="n">power_law</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
    <span class="n">fit</span><span class="o">.</span><span class="n">power_law</span><span class="o">.</span><span class="n">plot_pdf</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> \
                            <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\alpha = </span><span class="si">%d</span><span class="s2"> \:\:, x_</span><span class="si">{min}</span><span class="s2"> = </span><span class="si">%d</span><span class="s2">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Probability$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="n">data_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;From User&#39;</span><span class="p">]:</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;rainbow_r&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plotPowerlaw</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
             <span class="s1">&#39;$Tweets$&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/06_data_cleaning_Tweets_50_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="5.-&#28165;&#27927;tweets&#25991;&#26412;">5. &#28165;&#27927;tweets&#25991;&#26412;<a class="anchor-link" href="#5.-&#28165;&#27927;tweets&#25991;&#26412;"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;RT @AnonKitsu: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">twitter_text</span>
<span class="c1"># https://github.com/dryan/twitter-text-py/issues/21</span>
<span class="c1">#Macintosh HD â–¸ ç”¨æˆ· â–¸ datalab â–¸ åº”ç”¨ç¨‹åº â–¸ anaconda â–¸ lib â–¸ python3.5 â–¸ site-packages</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#23433;&#35013;twitter_text">&#23433;&#35013;twitter_text<a class="anchor-link" href="#&#23433;&#35013;twitter_text"> </a></h1><p><a href="https://github.com/dryan/twitter-text-py/issues/21">twitter-text-py</a> could not be used for python 3</p>
<blockquote><h3 id="pip-install-twitter-text"><del>pip install twitter-text</del><a class="anchor-link" href="#pip-install-twitter-text"> </a></h3>
</blockquote>
<p>Glyph debug the problem, and make <a href="https://github.com/glyph/twitter-text-py">a new repo of twitter-text-py3</a>.</p>
<blockquote><h2 id="pip-install-twitter-text">pip install twitter-text<a class="anchor-link" href="#pip-install-twitter-text"> </a></h2>
</blockquote>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#26080;&#27861;&#27491;&#24120;&#23433;&#35013;&#30340;&#21516;&#23398;">&#26080;&#27861;&#27491;&#24120;&#23433;&#35013;&#30340;&#21516;&#23398;<a class="anchor-link" href="#&#26080;&#27861;&#27491;&#24120;&#23433;&#35013;&#30340;&#21516;&#23398;"> </a></h1><h2 id="&#21487;&#20197;&#22312;spyder&#20013;&#25171;&#24320;terminal&#23433;&#35013;">&#21487;&#20197;&#22312;spyder&#20013;&#25171;&#24320;terminal&#23433;&#35013;<a class="anchor-link" href="#&#21487;&#20197;&#22312;spyder&#20013;&#25171;&#24320;terminal&#23433;&#35013;"> </a></h2><p>pip install twitter-text</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;RT @AnonKitsu: @who ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>

<span class="n">rt_patterns</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(RT|via)((?:\b\W*@\w+)+)&quot;</span><span class="p">,</span> \
                         <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_patterns</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tweet</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; @&#39;</span><span class="p">)</span><span class="c1">#.split(&#39;:&#39;)[0]</span>
<span class="n">rt_user_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;AnonKitsu: @who&#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;RT @AnonKitsu: @who ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>

<span class="n">rt_patterns</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(RT|via)((?:\b\W*@\w+)+)&quot;</span><span class="p">,</span> \
                         <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_patterns</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tweet</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; @&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rt_user_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;AnonKitsu&#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;@chengjun:@who ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>

<span class="n">rt_patterns</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(RT|via)((?:\b\W*@\w+)+)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_patterns</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rt_user_name</span><span class="p">)</span>

<span class="k">if</span> <span class="n">rt_user_name</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;it exits.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[]
None
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">):</span>
    <span class="n">rt_patterns</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(RT|via)((?:\b\W*@\w+)+)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_patterns</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rt_user_name</span><span class="p">:</span>
        <span class="n">rt_user_name</span> <span class="o">=</span> <span class="n">rt_user_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; @&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rt_user_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">rt_user_name</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;RT @chengjun: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>

<span class="n">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>    
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;chengjun&#39;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;@chengjun: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>None
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/ows_tweets_sample.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
<span class="n">rt_network</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="n">tweet_user_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
<span class="n">tweet_user_data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;RT @AnonKitsu: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE RT !!HELP!!!!&#39;,
  &#39;Anonops_Cop&#39;),
 (&#39;@jamiekilstein @allisonkilkenny Interesting interview (never aired, wonder why??) by Fox with #ows protester http://t.co/Fte55Kh7&#39;,
  &#39;KittyHybrid&#39;),
 (&#34;@Seductivpancake Right! Those guys have a victory condition: regime change. #ows doesn&#39;t seem to have a goal I can figure out.&#34;,
  &#39;nerdsherpa&#39;)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="n">rt_network</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rt_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tweet_user_data</span><span class="p">):</span>
    <span class="n">tweet</span><span class="p">,</span><span class="n">user</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">rt_user</span> <span class="o">=</span> <span class="n">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rt_user</span><span class="p">:</span>
        <span class="n">rt_network</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">user</span><span class="p">,</span> <span class="n">rt_user</span><span class="p">))</span> <span class="c1">#(rt_user,&#39;  &#39;, user, end = &#39;\n&#39;)</span>
        <span class="n">rt_dict</span><span class="p">[(</span><span class="n">user</span><span class="p">,</span> <span class="n">rt_user</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c1">#rt_network[:5]</span>
<span class="nb">list</span><span class="p">(</span><span class="n">rt_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[((&#39;OccupyNCGBORO&#39;, &#39;angela0328&#39;), 1),
 ((&#39;evlance&#39;, &#39;KeithOlbermann&#39;), 1),
 ((&#39;Lusho0487&#39;, &#39;anonops&#39;), 1)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#33719;&#24471;&#28165;&#27927;&#36807;&#30340;&#25512;&#29305;&#25991;&#26412;">&#33719;&#24471;&#28165;&#27927;&#36807;&#30340;&#25512;&#29305;&#25991;&#26412;<a class="anchor-link" href="#&#33719;&#24471;&#28165;&#27927;&#36807;&#30340;&#25512;&#29305;&#25991;&#26412;"> </a></h1><p>ä¸å«äººåã€urlã€å„ç§ç¬¦å·ï¼ˆå¦‚RT @ç­‰ï¼‰</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extract_tweet_text</span><span class="p">(</span><span class="n">tweet</span><span class="p">,</span> <span class="n">at_names</span><span class="p">,</span> <span class="n">urls</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">at_names</span><span class="p">:</span>
        <span class="n">tweet</span> <span class="o">=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">tweet</span> <span class="o">=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">marks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">marks</span><span class="p">:</span>
        <span class="n">tweet</span> <span class="o">=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tweet</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">twitter_text</span>

<span class="n">tweet</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;RT @AnonKitsu: ALERT!!!!!!!!!!COPS ARE KETTLING PROTESTERS IN PARK W HELICOPTERS AND PADDYWAGONS!!!! </span>
<span class="s1">            #OCCUPYWALLSTREET #OWS #OCCUPYNY PLEASE @chengjun @mili http://computational-communication.com </span>
<span class="s1">            http://ccc.nju.edu.cn RT !!HELP!!!!&#39;&#39;&#39;</span>

<span class="n">ex</span> <span class="o">=</span> <span class="n">twitter_text</span><span class="o">.</span><span class="n">Extractor</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
<span class="n">at_names</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">extract_mentioned_screen_names</span><span class="p">()</span>
<span class="n">urls</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">extract_urls</span><span class="p">()</span>
<span class="n">hashtags</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">extract_hashtags</span><span class="p">()</span>
<span class="n">rt_user</span> <span class="o">=</span> <span class="n">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
<span class="c1">#tweet_text = extract_tweet_text(tweet, at_names, urls)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">at_names</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">hashtags</span><span class="p">,</span> <span class="n">rt_user</span><span class="p">,</span><span class="s1">&#39;--------&gt;&#39;</span><span class="p">)</span><span class="c1">#, tweet_text)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;AnonKitsu&#39;, &#39;chengjun&#39;, &#39;mili&#39;] [&#39;http://computational-communication.com&#39;, &#39;http://ccc.nju.edu.cn&#39;] [&#39;OCCUPYWALLSTREET&#39;, &#39;OWS&#39;, &#39;OCCUPYNY&#39;] AnonKitsu --------&gt;
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">twitter_text</span><span class="o">.</span><span class="n">Extractor</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="n">at_names</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">extract_mentioned_screen_names</span><span class="p">()</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">extract_urls</span><span class="p">()</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">extract_hashtags</span><span class="p">()</span>
    <span class="n">rt_user</span> <span class="o">=</span> <span class="n">extract_rt_user</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="c1">#tweet_text = extract_tweet_text(tweet, at_names, urls)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">at_names</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">hashtags</span><span class="p">,</span> <span class="n">rt_user</span><span class="p">)</span>
    <span class="c1">#print(tweet_text)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[] [] [] None
[&#39;AnonKitsu&#39;] [] [&#39;OCCUPYWALLSTREET&#39;, &#39;OWS&#39;, &#39;OCCUPYNY&#39;] AnonKitsu
[&#39;jamiekilstein&#39;, &#39;allisonkilkenny&#39;] [&#39;http://t.co/Fte55Kh7&#39;] [&#39;ows&#39;] None
[&#39;Seductivpancake&#39;] [] [&#39;ows&#39;] None
[&#39;bembel&#39;] [&#39;http://j.mp/rhHavq&#39;] [&#39;OccupyWallStreet&#39;, &#39;OWS&#39;] bembel
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#24605;&#32771;&#65306;">&#24605;&#32771;&#65306;<a class="anchor-link" href="#&#24605;&#32771;&#65306;"> </a></h1><h3 id="&#25552;&#21462;&#20986;raw-tweets&#20013;&#30340;rtuser&#19982;user&#30340;&#36716;&#21457;&#32593;&#32476;">&#25552;&#21462;&#20986;raw tweets&#20013;&#30340;rtuser&#19982;user&#30340;&#36716;&#21457;&#32593;&#32476;<a class="anchor-link" href="#&#25552;&#21462;&#20986;raw-tweets&#20013;&#30340;rtuser&#19982;user&#30340;&#36716;&#21457;&#32593;&#32476;"> </a></h3><h2 id="&#26684;&#24335;&#65306;">&#26684;&#24335;&#65306;<a class="anchor-link" href="#&#26684;&#24335;&#65306;"> </a></h2><p>rt_user1, user1, 3</p>
<p>rt_user2, user3, 2</p>
<p>rt_user2, user4, 1</p>
<p>...</p>
<p>æ•°æ®ä¿å­˜ä¸ºcsvæ ¼å¼</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#38405;&#35835;&#25991;&#29486;">&#38405;&#35835;&#25991;&#29486;<a class="anchor-link" href="#&#38405;&#35835;&#25991;&#29486;"> </a></h1>
</div>
</div>
</div>
</div>

 


</main>
